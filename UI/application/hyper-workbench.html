<!DOCTYPE html>
<html>
<!--
File: hyper-workbench.html
Description: JavaScript Workbench and Log panel.
Author: Mikael Kindborg
Copyright (c) 2013 Mikael Kindborg
-->
<head>
<meta charset="utf-8">

<title>HyperReload Workbench</title>

<link rel="stylesheet" href="libs/jquery/themes/sunny/jquery-ui.min.css" />
<link rel="stylesheet" href="libs/jquery/layout-default-latest.css" />
	
<script src="libs/jquery/jquery-2.0.3.min.js"></script>
<script src="libs/jquery/jquery-ui-1.10.3.custom.min.js"></script>
<script src="libs/jquery/jquery.layout-latest.min.js"></script>
<script src="libs/jquery/jquery.layout-latest.min.js"></script>

<link rel="stylesheet" href="libs/codemirror-3.15/lib/codemirror.css">
<script src="libs/codemirror-3.15/lib/codemirror.js"></script>
<script src="libs/codemirror-3.15/addon/edit/matchbrackets.js"></script>
<script src="libs/codemirror-3.15/addon/edit/continuecomment.js"></script>
<script src="libs/codemirror-3.15/addon/comment/comment.js"></script>
<script src="libs/codemirror-3.15/mode/javascript/javascript.js"></script>

<style>
.CodeMirror 
{
	font-family: monospace;
	font-size: 18px;
	height: 100%;
}

.ui-layout-pane 
{
	background: #FFF; 
	border: 1px solid #BBB;
	padding: 0px; 
	overflow: auto;
} 

#toolbar 
{
	color: #111111;
	background: #EEEEE0;
	border: 1px solid #BBB;
	border-bottom-style:solid;
	border-bottom-width:1px;
	border-bottom-color:#BBB;
	padding: 5px 5px 5px 5px; 
	font-size: 0.8em; 
	font-family: Sans-serif;
}

#codearea 
{
	position: absolute;
	left: 0px;
	top: 0px;
	right: 0px;
	bottom: 0px;
	padding: 0px; 
}

#resultarea 
{
	position: absolute;
	left: 0px;
	top: 2.5em;
	right: 0px;
	bottom: 0px;
	padding: 0px; 
}

button 
{
	line-height: normal;
}
</style>
</head>

<body>

<div class="ui-layout-center">
	
<div id="codearea">
<textarea id="codeeditor">
// -----------------------------------------------------
//          Welcome to HyperReload Workbench 
// -----------------------------------------------------
//
// The Workbench has two parts. This part is a JavaScript 
// editor where you can evaluate selected code on connected 
// devices/browsers.
//
// The second part is the message panel below. Here log messages
// from devices are displayed, and the result from evaluating
// JavaScript code.
//
// Get started by selecting a line of the example code below, 
// then press the "Eval on Devices" button. This will run the
// selected code on any connected devices/browsers.
//
// The button "Eval in NodeWebkit" is an experimental feature
// that lets you to evaluate code locally in HyperReload, which
// runs on top of node-webkit. This gives you full interactive
// access to node-webkit and to node.js, a potentially very
// powerful feature. This can be used for experimenting with
// node.js and node-webkit, and for running scripted tests
// on connected devices.
// -----------------------------------------------------

// Send log message from connected devices/browsers. Use this
// in your application code for debugging.
hyper.log('Hello World')

// Replace the browser content with the given HTML. What do you
// think will happen if you evaluate this with "Eval in Node"?
document.body.innerHTML = '<h1>Hello World</h1>'
</textarea>
</div>

</div> <!-- center -->

<div class="ui-layout-south">

<div id="toolbar">
	<input value="Eval on Devices" class="buttonEval" type="button" />
	<input value="Undo" class="buttonUndo" type="button" />
	<input value="Redo" class="buttonRedo" type="button" />
	<input value="Clear Log" class="buttonClearLog" type="button" />
	<input value="Eval in NodeWebkit" class="buttonEvalInNodeJs" type="button" />
</div>

<div id="resultarea">
<textarea id="resulteditor" >
Message Area - Log messages are displayed here
</textarea>
</div>

</div> <!-- south -->


<script>
</script>

<script>
$(function() 
{
	// Main application window
	var mMainWindow = window.opener
	
	// Editor component.
	var editor = CodeMirror.fromTextArea(document.getElementById('codeeditor'), 
	{
		mode: 'javascript',
		indentUnit: 4,
		autoMatchParens: true,
		lineNumbers: true,
		matchBrackets: true,
		continueComments: 'Enter',
		extraKeys: {'Ctrl-Q': 'toggleComment'}
	})

	// Result/log component.
	var result = CodeMirror.fromTextArea(document.getElementById('resulteditor'), 
	{
	})

	$('input.buttonEval').click(function() 
	{
		if (!mMainWindow)
		{
			showResult('ERR: Could not find main window - report to developer')
			return
		}
		
		if (!editor.somethingSelected())
		{
			showResult('Select some code to evaluate')
			return
		}
		
		var code = editor.getSelection()
		mMainWindow.postMessage({ message: 'eval', code: code }, '*')
	})
	
	$('input.buttonEvalInNodeJs').click(function() 
	{
		if (!mMainWindow)
		{
			showResult('ERR: Could not find main window - report to developer')
			return
		}
		
		if (!editor.somethingSelected())
		{
			showResult('Select some code to evaluate')
			return
		}
		
		try
		{
			var code = editor.getSelection()
			var result = eval(code)
			showResult('NODE: ' + result)
		}
		catch (err)
		{
			showResult('ERR: ' + err)
		}
		
	})
	
	$('input.buttonUndo').click(function() 
	{
		editor.undo()
	})

	$('input.buttonRedo').click(function() 
	{
		editor.redo()
	})
	
	$('input.buttonClearLog').click(function() 
	{
		result.setValue('')
	})

	/*
	$('input.buttonEvalInBrowser').click(function() 
	{
		try 
		{
			var code = editor.selection();
			var res = eval(code);
			showResult(res); 
		}
		catch (error) 
		{
			 showResult('Error: ' + error); }
	});
	*/
	
	function showResult(res)
	{
		result.setValue(res + '\n' + result.getValue()); 
	}

	//$('body').layout({ applyDefaultStyles: true })
	$('body').layout(
	{
		south: { size: 300 },
		//center: { maskContents: true },
		fxName: 'none'
	})
	
	function receiveMessage(event)
	{
		//console.log('Workbench got : ' + event.data.message)
		if ('hello' == event.data.message)
		{
			mMainWindow = event.source
		}
		else if ('log' == event.data.message)
		{
			showResult('LOG: ' + event.data.logMessage)
		}
		else if ('jsResult' == event.data.message)
		{
			showResult('JS: ' + event.data.result)
		}
	}
	
	window.addEventListener('message', receiveMessage, false)
})
</script>
</body>
</html>
